<!DOCTYPE html>
<html lang="fr">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script src="js/script.js"></script>
        <script src="https://cdn.pubnub.com/sdk/javascript/pubnub.4.18.0.min.js"></script>
    <script type="text/javascript" src="https://pubnub.github.io/eon/v/eon/1.0.0/eon.js"></script>
    <link type="text/css" rel="stylesheet" href="https://pubnub.github.io/eon/v/eon/1.0.0/eon.css"/>
        <title>Document</title>
    </head>
    <body>
      <div id="bitcoinChart"></div>

    <script>

        var pubnub = new PubNub({
            publishKey: 'demo',
            subscribeKey: 'demo'
        });
        var xhr = new XMLHttpRequest();
        
        var pointLimit = 100;
        var useLabels = false;

        function processRequest(e) {
             if (xhr.readyState == 4 && xhr.status == 200) {
                var response = JSON.parse(xhr.responseText);
                console.log(response);

                pubnub.publish({
                    channel: 'bitcoin-eon',
                    message: {
                      eon: {
                        'BitCoin': response.BTC.USD.toFixed(2)
                      }
                    }
                  });
                 //var notification = new Notification("Hi there!");
            }
        }

        eon.chart({
          channels: ['bitcoin-eon'],
          history: true,
          flow: true,
          limit: pointLimit,
          pubnub: pubnub,
          generate: {
            bindto: '#bitcoinChart',
            data: {
              labels: useLabels,
              type: 'spline'
            },
            axis: {
                y: {
                    padding: {top:200, bottom:100}
                }
            }
          }
        });

        

        function mainApp() {
            

            setInterval(function(){
                
                xhr.open('GET', 'https://min-api.cryptocompare.com/data/pricemulti?fsyms=BTC,ETH,LTC&tsyms=USD', true)
                xhr.send();
                xhr.onreadystatechange = processRequest;
            }, 500)
        };
        mainApp();

    </script>
    </body>
</html>